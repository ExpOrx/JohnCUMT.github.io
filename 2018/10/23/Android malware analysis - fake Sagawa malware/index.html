<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="大道至简"><title> | Zero</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Zero</h1><a id="logo" href="/.">Zero</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title"></h1><div class="post-meta">Oct 23, 2018</div><div class="post-content"><h1 id="Android-malware-analysis-fake-Sagawa-malware"><a href="#Android-malware-analysis-fake-Sagawa-malware" class="headerlink" title="Android malware analysis - fake Sagawa malware"></a>Android malware analysis - fake Sagawa malware</h1><p>标签（空格分隔）： AndroidSec</p>
<hr>
<h2 id="1-0-样本信息"><a href="#1-0-样本信息" class="headerlink" title="1.0 样本信息"></a>1.0 样本信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MD5:0fdc23ae9445ab84e2b9d4824ea137f8</span><br><span class="line">证书指纹:</span><br><span class="line">  MD-5: 2BB211C701B44AF41C9B52274B3C7B28 </span><br><span class="line">  SHA-1: 05FB1C007D4A3D43F3E6008ED11FDEB46E948120 </span><br><span class="line">  SHA-256: F020E1491710E0BDEB3ED1FEC7C459C9F855A16C5DB57DBA56629711B1BB32AB</span><br></pre></td></tr></table></figure>
<h2 id="2-0-静态分析"><a href="#2-0-静态分析" class="headerlink" title="2.0 静态分析"></a>2.0 静态分析</h2><h3 id="2-1-程序入口"><a href="#2-1-程序入口" class="headerlink" title="2.1 程序入口"></a>2.1 程序入口</h3><p><img src="https://i.screenshot.net/j3987ar" alt=""></p>
<h3 id="2-2-libxxn-so分析"><a href="#2-2-libxxn-so分析" class="headerlink" title="2.2 libxxn.so分析"></a>2.2 libxxn.so分析</h3><p><img src="https://i.screenshot.net/v835zuz" alt=""></p>
<h4 id="2-2-1-Java-huaa-TII-run函数"><a href="#2-2-1-Java-huaa-TII-run函数" class="headerlink" title="2.2.1 Java_huaa_TII_run函数"></a>2.2.1 Java_huaa_TII_run函数</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">fastcall <span class="title">Java_huaa_TII_run</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3, <span class="keyword">int</span> a4, <span class="keyword">int</span> a5, <span class="keyword">int</span> a6, <span class="keyword">int</span> a7)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> j_rrr(a1, a3, a4, a5, a6, a7);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-2-j-rrr函数"><a href="#2-2-2-j-rrr函数" class="headerlink" title="2.2.2 j_rrr函数"></a>2.2.2 j_rrr函数</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">fastcall <span class="title">j_rrr</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3, <span class="keyword">int</span> a4, <span class="keyword">int</span> a5, <span class="keyword">int</span> a6)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> rrr(a1, a2, a3, a4, a5, a6);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-3-rrr函数-先将Asset目录下的nini-dll解密生成mycode-jar-然后将mycode-jar的部分数据生成mycode-dex，然后载入dex-然后删除jar和dex"><a href="#2-2-3-rrr函数-先将Asset目录下的nini-dll解密生成mycode-jar-然后将mycode-jar的部分数据生成mycode-dex，然后载入dex-然后删除jar和dex" class="headerlink" title="2.2.3 rrr函数,先将Asset目录下的nini.dll解密生成mycode.jar,然后将mycode.jar的部分数据生成mycode.dex，然后载入dex,然后删除jar和dex"></a>2.2.3 rrr函数,先将Asset目录下的nini.dll解密生成mycode.jar,然后将mycode.jar的部分数据生成mycode.dex，然后载入dex,然后删除jar和dex</h4><p><img src="https://i.screenshot.net/njjowao" alt=""></p>
<h3 id="2-3-拿到mycode-jar进行分析-一部分是证书，另外一部分是dex"><a href="#2-3-拿到mycode-jar进行分析-一部分是证书，另外一部分是dex" class="headerlink" title="2.3 拿到mycode.jar进行分析,一部分是证书，另外一部分是dex"></a>2.3 拿到mycode.jar进行分析,一部分是证书，另外一部分是dex</h3><p><img src="https://i.screenshot.net/r33p4i8" alt=""></p>
<h4 id="2-3-1-主Activity分析"><a href="#2-3-1-主Activity分析" class="headerlink" title="2.3.1 主Activity分析"></a>2.3.1 主Activity分析</h4><p><img src="https://i.screenshot.net/7gz7ns8" alt=""></p>
<h4 id="2-3-2-UK-class服务分析"><a href="#2-3-2-UK-class服务分析" class="headerlink" title="2.3.2 UK.class服务分析"></a>2.3.2 UK.class服务分析</h4><p><img src="https://i.screenshot.net/1kq3mcd" alt=""></p>
<h4 id="2-3-3-BK-class服务分析"><a href="#2-3-3-BK-class服务分析" class="headerlink" title="2.3.3 BK.class服务分析"></a>2.3.3 BK.class服务分析</h4><p><img src="https://i.screenshot.net/06ld9f1" alt=""></p>
<h4 id="2-3-4-申请成为Device-Admin权限的LA类，但是没有调用"><a href="#2-3-4-申请成为Device-Admin权限的LA类，但是没有调用" class="headerlink" title="2.3.4 申请成为Device Admin权限的LA类，但是没有调用"></a>2.3.4 申请成为Device Admin权限的LA类，但是没有调用</h4><p><img src="https://i.screenshot.net/52lzmuy" alt=""></p>
<h4 id="2-3-5-保存恶意url的xml"><a href="#2-3-5-保存恶意url的xml" class="headerlink" title="2.3.5 保存恶意url的xml"></a>2.3.5 保存恶意url的xml</h4><p><img src="https://i.screenshot.net/120y5um" alt=""></p>
<h4 id="2-3-6-下载new-apk的类，也没有调用"><a href="#2-3-6-下载new-apk的类，也没有调用" class="headerlink" title="2.3.6 下载new.apk的类，也没有调用"></a>2.3.6 下载new.apk的类，也没有调用</h4><p><img src="https://i.screenshot.net/vzkp2b7" alt=""></p>
<h2 id="3-行为分析"><a href="#3-行为分析" class="headerlink" title="3 行为分析"></a>3 行为分析</h2><h3 id="3-1-servlet-xx-内容"><a href="#3-1-servlet-xx-内容" class="headerlink" title="3.1 /servlet/xx 内容"></a>3.1 /servlet/xx 内容</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST http://125.227.174.32//servlet/xx HTTP/1.1</span><br><span class="line">ser-Agent: Fiddler</span><br><span class="line">Content-Type: application/json</span><br><span class="line">User-Agent: Dalvik/2.1.0 (Linux; U; Android 6.0.1; MuMu Build/V417IR)</span><br><span class="line">Host: 125.227.174.32</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Accept-Encoding: gzip</span><br><span class="line">Content-Length: 134</span><br><span class="line"></span><br><span class="line">&#123;&quot;json&quot;:&quot;&#123;\&quot;mobile\&quot;:\&quot;008796758773174\&quot;,\&quot;machine\&quot;:\&quot;MuMu\&quot;,\&quot;sversion\&quot;:\&quot;6.0.1\&quot;,\&quot;bank\&quot;:\&quot;\&quot;,\&quot;provider\&quot;:\&quot;\&quot;,\&quot;npki\&quot;:\&quot;1\&quot;&#125;&quot;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-servlet-GetMessag-内容"><a href="#3-2-servlet-GetMessag-内容" class="headerlink" title="3.2 /servlet/GetMessag 内容"></a>3.2 /servlet/GetMessag 内容</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST http://125.227.174.32//servlet/GetMessage HTTP/1.1</span><br><span class="line">ser-Agent: Fiddler</span><br><span class="line">Content-Type: application/json</span><br><span class="line">User-Agent: Dalvik/2.1.0 (Linux; U; Android 6.0.1; MuMu Build/V417IR)</span><br><span class="line">Host: 125.227.174.32</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Accept-Encoding: gzip</span><br><span class="line">Content-Length: 30</span><br><span class="line"></span><br><span class="line">&#123;&quot;json&quot;:&quot;&#123;\&quot;mobile\&quot;:\&quot;xx\&quot;&#125;&quot;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-3-servlet-GetMoreMessage-内容"><a href="#3-3-servlet-GetMoreMessage-内容" class="headerlink" title="3.3 /servlet/GetMoreMessage 内容"></a>3.3 /servlet/GetMoreMessage 内容</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST http://125.227.174.32//servlet/GetMoreMessage HTTP/1.1</span><br><span class="line">ser-Agent: Fiddler</span><br><span class="line">Content-Type: application/json</span><br><span class="line">User-Agent: Dalvik/2.1.0 (Linux; U; Android 6.0.1; MuMu Build/V417IR)</span><br><span class="line">Host: 125.227.174.32</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Accept-Encoding: gzip</span><br><span class="line">Content-Length: 43</span><br><span class="line"></span><br><span class="line">&#123;&quot;json&quot;:&quot;&#123;\&quot;mobile\&quot;:\&quot;008796758773174\&quot;&#125;&quot;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-威胁情报"><a href="#4-威胁情报" class="headerlink" title="4 威胁情报"></a>4 威胁情报</h3><ul>
<li><a href="http://125.227.174.32/" target="_blank" rel="noopener">http://125.227.174.32/</a>  中国-台湾  垃圾邮件</li>
<li><a href="http://sagawa-aiai.com/" target="_blank" rel="noopener">http://sagawa-aiai.com/</a> 对应IP 114.40.189.238 中国-台湾-高雄市</li>
<li><a href="http://67.198.138.244:8081" target="_blank" rel="noopener">http://67.198.138.244:8081</a> 美国-加利福尼亚州-洛杉矶</li>
</ul>
<h3 id="5-吃颗同事的喜糖，沾沾喜气顺便平复一下单身加班的心情"><a href="#5-吃颗同事的喜糖，沾沾喜气顺便平复一下单身加班的心情" class="headerlink" title="5 吃颗同事的喜糖，沾沾喜气顺便平复一下单身加班的心情"></a>5 吃颗同事的喜糖，沾沾喜气顺便平复一下单身加班的心情</h3><p><img src="https://i.screenshot.net/p75m4ur" alt=""></p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2018/10/23/Android查壳/"></a><a class="next" href="/2018/10/23/脚本病毒RANSOMWARE分析报告/">脚本病毒RANSOMWARE分析报告</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/狮鹫勒索者分析分析/">狮鹫勒索者分析分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/Android查壳/">Android查壳</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/Android malware analysis - fake Sagawa malware/">Android malware analysis - fake Sagawa malware</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/脚本病毒RANSOMWARE分析报告/">脚本病毒RANSOMWARE分析报告</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/类Unix平台的DDOS攻击样本分析/">类Unix平台的DDOS攻击样本分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/试着逆向一次windows PE文件/">试着逆向一次windows PE文件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/Sql Injection 代码审计 2018-08-21/">Sql Injection 代码审计 2018-08-21</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/Man-in-the-Disk：通过公开的外部存储攻击Android应用程序/">Man-in-the-Disk：通过公开的外部存储攻击Android应用程序</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/Android白盒审计之代码定位/">Android白盒审计之代码定位</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/某APP/">某APP</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Zero.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>